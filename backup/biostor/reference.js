{"_id":"_design/reference","_rev":"1-0cf5c36d35baf6cc45bfcdfcc3608f91","language":"javascript","views":{"nt":{"map":"/*\n\nShared code\n\n\n*/\n\n//----------------------------------------------------------------------------------------\n// http://stackoverflow.com/a/25715455\nfunction isObject (item) {\n  return (typeof item === \"object\" && !Array.isArray(item) && item !== null);\n}\n\n//----------------------------------------------------------------------------------------\n// http://stackoverflow.com/a/21445415\nfunction uniques(arr) {\n  var a = [];\n  for (var i = 0, l = arr.length; i < l; i++)\n    if (a.indexOf(arr[i]) === -1 && arr[i] !== '')\n      a.push(arr[i]);\n  return a;\n}\n\n\t\t\n//----------------------------------------------------------------------------------------\n// Store a triple with optional language code\nfunction triple(subject, predicate, object, language) {\n  var triple = [];\n  triple[0] = subject;\n  triple[1] = predicate;\n  triple[2] = object;\n  \n  if (typeof language === 'undefined') {\n  } else {\n    triple[3] = language;\n  }\n  \n  return triple;\n}\n\n//----------------------------------------------------------------------------------------\n// Store a quad (not used at present)\nfunction quad(subject, predicate, object, context) {\n  var triple = [];\n  triple[0] = $subject;\n  triple[1] = $predicate;\n  triple[2] = $object;\n  triple[3] = $context;\n  \n  return triple;\n}\n\n//----------------------------------------------------------------------------------------\n// Enclose triple in suitable wrapping for HTML display or triplet output\nfunction wrap(s, html) {\nif (s) {\n\n  if (s.match(/^(http|urn|_:)/)) {\n    if (html) {\n      s = '&lt;' + s + '&gt;';\n    } else {\n      s = '<' + s + '>';\n    }\n  } else {\n    s = '\"' + s.replace(/\"/g, '\\\\\"') + '\"';\n  }}\n  return s;\n}\n\n//----------------------------------------------------------------------------------------\n// https://css-tricks.com/snippets/javascript/htmlentities-for-javascript/\nfunction htmlEntities(str) {\n    return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n}\n\n//----------------------------------------------------------------------------------------\nfunction output(doc, triples) {\n \n \t  for (var i in triples) {\n\t\tvar s = 0;\n\t\tvar p = 1;\n\t\tvar o = 2;\n\t\t//emit([wrap(triples[i][s], false), wrap(triples[i][p], false), wrap(triples[i][o], false)], 1);\n\n    var lang = 3;\n\n      var nquads = wrap(triples[i][s], false) \n\t    \t+ ' ' + wrap(triples[i][p], false) \n\t    \t+ ' ' + wrap(triples[i][o], false);\n\t    if (triples[i][lang]) {\n\t    \tnquads += '@' + triples[i][lang];\n\t    }\n\t    \t\n\t    nquads += ' .' + \"\\n\";\n\n\n      emit(doc._id, nquads);\n\t  }\n  \n}\n\n\n// START COUCHDB VIEW\nfunction message(doc) {\n\n\t// to do, make this more general\n    var subject_id = doc._id;\n\n\tif (subject_id.match(/^biostor\\/\\d+/)) {\n\t\tsubject_id = subject_id.replace(/biostor\\//, 'http://biostor.org/reference/');\n\t}\n\n\tif (subject_id.match(/^[a-z0-9]+$/)) {\n\t\tsubject_id = 'http://bionames.org/references/' + doc._id;\n\t}\n\n    var triples = [];\n    var type = '';\n\n    for (var i in doc) {\n    \n      switch (i) {\n      \n        case 'identifier':\n        \tfor (var j in doc[i]) {\n        \t\tswitch (doc[i][j].type) {\n        \t\t\n \t\t\t\t\tcase 'biostor':\n\t\t\t\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t\t\t\t'http://schema.org/identifier',\n\t\t\t\t\t\t\t'http://biostor.org/reference/' + doc[i][j].id));\n        \t\t\t\tbreak;\n        \t\t\n        \t\t\tcase 'doi':\n\t\t\t\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t\t\t\t'http://schema.org/identifier',\n\t\t\t\t\t\t\t'http://identifiers.org/doi/' + doc[i][j].id.toLowerCase()));\n        \t\t\t\tbreak;\n\n        \t\t\tcase 'handle':\n\t\t\t\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t\t\t\t'http://schema.org/identifier',\n\t\t\t\t\t\t\t'http://hdl.handle.net/' + doc[i][j].id));\n        \t\t\t\tbreak;\n        \t\t\t\t\n        \t\t\t// at this level it is the isbn for a book\n        \t\t\tcase 'isbn':\n\t\t\t\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t\t\t\t'http://schema.org/identifier',\n\t\t\t\t\t\t\t'http://identifiers.org/isbn/' + doc[i][j].id));\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t\t\t\t'http://schema.org/isbn',\n\t\t\t\t\t\t\tdoc[i][j].id));\n\t\t\t\t\t\t  \n        \t\t\t\tbreak;\n\n       \t\t\t\tcase 'jstor':\n\t\t\t\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t\t\t\t'http://schema.org/identifier',\n\t\t\t\t\t\t\t'http://www.jstor.org/stable/' + doc[i][j].id));\n        \t\t\t\tbreak;\n\n       \t\t\t\tcase 'oclc':\n\t\t\t\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t\t\t\t'http://schema.org/identifier',\n\t\t\t\t\t\t\t'http://www.worldcat.org/oclc/' + doc[i][j].id));\n        \t\t\t\tbreak;\n\n        \t\t\tcase 'pmc':\n\t\t\t\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t\t\t\t'http://schema.org/identifier',\n\t\t\t\t\t\t\t'http://identifiers.org/pmc/' + doc[i][j].id));\n        \t\t\t\tbreak;\n\n        \t\t\tcase 'pmid':\n\t\t\t\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t\t\t\t'http://schema.org/identifier',\n\t\t\t\t\t\t\t'http://identifiers.org/pmid/' + doc[i][j].id.toString()));\n        \t\t\t\tbreak;\n        \t\t\t\t\n        \t\t\tcase 'zoobank':\n\t\t\t\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t\t\t\t'http://schema.org/identifier',\n\t\t\t\t\t\t\t'http://zoobank.org/' + doc[i][j].id.toLowerCase()));\n\t\t\t\t\t\t\t\n \t\t\t\t\t\t\ttriples.push(triple(subject_id,\n\t\t\t\t\t\t\t'http://schema.org/identifier',\n\t\t\t\t\t\t\tdoc[i][j].id.toLowerCase()));\t\t\t\t\t\t\t\n        \t\t\t\tbreak;\n        \t\t\t\t       \t\t\n        \t\t\tdefault:\n        \t\t\t\tbreak;\n        \t\t}      \t\n        \t}\n        \tbreak;\n        \t\n        \t\n        case 'bhl_pages':\n\t\t\t// Treat collection of pages as a workExample,\n\t\t\t// and each page is a part of that workExample\n\t\t\tvar work_id = subject_id + '#pages';\n\t\t\t\n\t\t\ttriples.push(triple(subject_id,\n               \t\t\t'http://schema.org/workExample',\n\t\t\t\t\t\t  work_id));   \n\t\t\t\t\t\t  \n\t\t\t  triples.push(triple(work_id,\n\t\t\t'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n\t\t\t  'http://schema.org/CreativeWork'));\n\n            var page_counter = 1;\n            for (var j in doc[i]) {\n            \n               var page_id = 'http://www.biodiversity.org/page/' + doc[i][j];\n               \n               // link to article\n\t\t\t\ttriples.push(triple(work_id,\n               \t\t\t'http://schema.org/hasPart',\n\t\t\t\t\t\t  page_id));               \n               \n               triples.push(triple(page_id,\n               \t\t\t'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n\t\t\t\t\t\t  'http://schema.org/CreativeWork'));\n\t\t\t\t\t\t  \n\t\t\t\ttriples.push(triple(page_id,\n               \t\t\t'http://schema.org/name',\n\t\t\t\t\t\t  j));\t\n/*\t\t\t\t\t\t  \n\t\t\t\t// image\n\t\t\t\ttriples.push(triple(page_id,\n               \t\t\t'http://schema.org/image',\n\t\t\t\t\t\t'http://www.biodiversitylibrary.org/pageimage/' + doc[i][j]));\t\n\t\t\t\t\n\t\t\t\t// thumbnail\n\t\t\t\ttriples.push(triple(page_id,\n               \t\t\t'http://schema.org/thumbnailUrl',\n\t\t\t\t\t\t'http://www.biodiversitylibrary.org/pagethumb/' + doc[i][j]));\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t// ocr\n\t\t\t\ttriples.push(triple(page_id,\n               \t\t\t'http://schema.org/text',\n\t\t\t\t\t\t'http://www.biodiversitylibrary.org/pageocr/' + doc[i][j]));\t\n*/\n\t\t\t\ttriples.push(triple(page_id,\n               \t\t\t'http://schema.org/position',\n\t\t\t\t\t\tpage_counter.toString()));\t\n\t\t\t\t\t\t\t\t\t  \n            \tpage_counter++;\n            }\n        \tbreak;\n        \t\n        case 'link':\n           var link_count = 0;\n        \tfor (var j in doc[i]) {\n        \t\tswitch (doc[i][j].anchor) {\n        \t\t\n        \t\t\tcase 'LINK':\n        \t\t\t\turl = doc[i][j].url;\n        \t\t\t\turl = url.replace(/http:\\/\\/direct.biostor.org/, 'http://biostor.org'); // hack\n        \t\t\ttriples.push(triple(subject_id,\n\t\t\t\t\t\t  'http://schema.org/url',\n\t\t\t\t\t\t  url));\n        \t\t\t\tbreak;\n        \t\t\n        \t\t\tcase 'PDF':\n        \t\t\t\tvar link_id = subject_id + '#link_' + (link_count + 1);\n\n\t\t\t\t\t  // type\n\t\t\t\t\t  triples.push(triple(link_id,\n\t\t\t\t\t\t'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n\t\t\t\t\t\t'http://schema.org/CreativeWork'));\n\t\t\t\t\t\t\n\t\t\t\t\t \n\t\t\t\t\t\ttriples.push(triple(link_id,\n\t\t\t\t\t\t  'http://schema.org/url',\n\t\t\t\t\t\t  doc[i][j].url));\n\n\t\t\t\t\t\ttriples.push(triple(link_id,\n\t\t\t\t\t\t\t'http://schema.org/fileFormat',\n\t\t\t\t\t\t\t'application/pdf'));\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t// sha1\n\t\t\t\t\t\tif (doc.file) {\n\t\t\t\t\t\t  if (doc.file.sha1) {\n\t\t\t\t\t\t\ttriples.push(triple(link_id,\n\t\t\t\t\t\t\t\t'http://id.loc.gov/vocabulary/preservation/cryptographicHashFunctions/sha1',\n\t\t\t\t\t\t\t\tdoc.file.sha1));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// link to work\n\t\t\t\t\t\ttriples.push(triple(subject_id,\n\t\t\t\t\t\t  'http://schema.org/workExample',\n\t\t\t\t\t\t  link_id));\n       \t\t\t\tbreak;\n\n         \t\t\t\t       \t\t\n        \t\t\tdefault:\n        \t\t\t\tbreak;\n        \t\t}      \t\n        \t}\n        \tbreak;        \t\n\t\t\t\n\t\tcase 'type':\n\t\t\tswitch (doc[i]) {\n\t\t\t  case 'article':\n\t\t\t    type = 'http://schema.org/ScholarlyArticle';\n\t\t\t\tbreak;\n\t\t\t  case 'book':\n\t\t\t    type = 'http://schema.org/Book';\n\t\t\t\tbreak;\n\t\t\t  case 'chapter':\n\t\t\t    type = 'http://schema.org/Chapter';\n\t\t\t\tbreak;\n\t\t\t  default:\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\t\t\t  \n          // title can be string or array\n        case 'title':\n            triples.push(triple(subject_id,\n              'http://schema.org/name',\n              doc[i]));\n          break;\n\n        case 'journal':\n           var issn = '';\n           var oclc = '';\n           var journal_id = '';\n           \n           // do we have an ISSN?\n           if (doc.journal.identifier) {\n           \t for (var j in doc.journal.identifier) {\n           \t   if (doc.journal.identifier[j].type == 'issn') {\n           \t     issn = doc.journal.identifier[j].id;\n           \t   }\n           \t   if (doc.journal.identifier[j].type == 'oclc') {\n           \t     oclc = doc.journal.identifier[j].id;\n           \t   }\n           \t } \n           }\n           \n           if (issn != '') {\n\t\t\t journal_id = 'http://identifiers.org/issn/' + issn;\n\t\t   } else {\n\t\t     if (oclc != '') {\n\t\t       journal_id = 'http://www.worldcat.org/oclc/' + oclc;\n\t\t     } else {\n\t\t       // No identifier, just use name\n\t\t       triples.push(triple(subject_id,\n\t\t\t\t'http://prismstandard.org/namespaces/basic/2.1/publicationName',\n\t\t\t\tdoc.journal.name));\n\t\t     }\n\t\t   }\n\t\t   \n\t\t   if (journal_id != '') {\n\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t'http://schema.org/isPartOf',\n\t\t\t\tjournal_id\n\t\t\t  ));\n\t\t \n\t\t\t  // type\n\t\t\t  triples.push(triple(journal_id,\n\t\t\t\t'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n\t\t\t\t'http://schema.org/Periodical'));\n\t\t\t\t\n\t\t\t  // name\n\t\t\t  triples.push(triple(journal_id,\n\t\t\t\t'http://schema.org/name',\n\t\t\t\tdoc.journal.name));\n\t\t\t\t\n              if (issn != '') {       \n\t\t\t\t\ttriples.push(triple(journal_id,\n\t\t\t\t\t\t\t\t\t'http://schema.org/issn',\n\t\t\t\t\t\t\t\t\tissn));              \n               }  \n             \n\t\t\t\ttriples.push(triple(journal_id,\n\t\t\t\t\t\t'http://schema.org/identifier',\n\t\t\t\t\t\tjournal_id));              \n              \n              \n              // article metadata\n              if (doc.journal.volume) {\n\t\t\t\ttriples.push(triple(subject_id,\n\t\t\t  \t\t'http://schema.org/volumeNumber',\n\t\t\t  \t\tdoc.journal.volume.toString()));\n\t\t\t  }\n\n              if (doc.journal.issue) {\n\t\t\t\ttriples.push(triple(subject_id,\n\t\t\t  \t\t'http://schema.org/issueNumber',\n\t\t\t  \t\tdoc.journal.issue.toString()));\n\t\t\t  }\n \n              if (doc.journal.pages) {\n\t\t\t\t\tvar parts = doc.journal.pages.match(/^(.*)\\--(.*)$/);\n\t\t\t\t\tif (parts) {\n\t\t\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t\t\t'http://schema.org/pageStart',\n\t\t\t\t\t\tparts[1]));\n\t\t\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t\t\t'http://schema.org/pageEnd',\n\t\t\t\t\t\tparts[2]));\n\t\t\t\t\t} else {\n\t\t\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t\t\t'http://schema.org/pagination',\n\t\t\t\t\t\tdoc.journal.pages.toString()));\n\t\t\t\t\t}              \n\t\t\t  }\n            \n           \n           \n           }\n           break;\n           \n        // book (chapter)\n        case 'book':\n           var isbn = '';\n           var oclc = '';\n           var book_id = '';\n           \n           // do we have an ISBN?\n           if (doc.book.identifier) {\n           \t for (var j in doc.book.identifier) {\n           \t   if (doc.book.identifier[j].type == 'isbn') {\n           \t     isbn = doc.book.identifier[j].id;\n           \t   }\n           \t   if (doc.book.identifier[j].type == 'oclc') {\n           \t     oclc = doc.book.identifier[j].id;\n           \t   }\n           \t } \n           }\n           \n           if (isbn != '') {\n\t\t\t book_id = 'http://identifiers.org/isbn/' + isbn;\n\t\t   } else {\n\t\t     if (oclc != '') {\n\t\t\t   book_id = 'http://www.worldcat.org/oclc/' + oclc;\n\t\t     }\n\t\t   }\n\t\t   \n\t\t   if (book_id != '') {\n\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t'http://schema.org/isPartOf',\n\t\t\t\tbook_id\n\t\t\t  ));\n\t\t \n\t\t\t  // type\n\t\t\t  triples.push(triple(book_id,\n\t\t\t\t'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n\t\t\t\t'http://schema.org/Book'));\n\t\t\t\t\n\t\t\t  // name\n\t\t\t  triples.push(triple(book_id,\n\t\t\t\t'http://schema.org/name',\n\t\t\t\tdoc.book.title));\n\t\t\t\t\n              if (isbn != '') {              \n\t\t\t\t\ttriples.push(triple(book_id,\n\t\t\t\t\t\t\t\t\t'http://schema.org/isbn',\n\t\t\t\t\t\t\t\t\tisbn));              \n              }\n\t\t\ttriples.push(triple(book_id,\n\t\t\t\t\t'http://schema.org/identifier',\n\t\t\t\t\tbook_id));              \n              \n              // chapter metadata\n              \n              if (doc.book.editor) {\n\t\t\t\t\tvar n = doc.book.editor.length;\n\t\t\t\n\t\t\t\t\t// store an ordered list of authors as well\n\t\t\t\n\t\t\t\t\t//http://purl.org/ontology/bibo/contributorList\n\t\t\t\n\t\t\t\n\t\t\t\t\tfor (var j = 0; j < n; j++) {\n\t\t\t\t\t  var editor_id = '';\n\n\t\t\t\t\t  // create identifier\n\t\t\t\t\t  editor_id = subject_id + '#editor_' + (j + 1);\n\n\t\t\t\t\t  // type, need to handle organisations as authors\n\t\t\t\t\t  triples.push(triple(editor_id,\n\t\t\t\t\t\t'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n\t\t\t\t\t\t'http://schema.org/Person'));\n\n\t\t\t\t\t  triples.push(triple(book_id,\n\t\t\t\t\t\t'http://schema.org/editor',\n\t\t\t\t\t\teditor_id));\n\n\t\t\t\t\t  // name\n\t\t\t\t\t  if (doc.book.editor[j].firstname) {\n\t\t\t\t\t\ttriples.push(triple(editor_id,\n\t\t\t\t\t\t  'http://schema.org/givenName', // ?\n\t\t\t\t\t\t  doc.book.editor[j].firstname));\n\t\t\t\t\t  }\n\n\t\t\t\t\t  if (doc.book.editor[j].lastname) {\n\t\t\t\t\t\ttriples.push(triple(editor_id,\n\t\t\t\t\t\t  'http://schema.org/familyName', // ?\n\t\t\t\t\t\t  doc.book.editor[j].lastname));\n\t\t\t\t\t  }\n\t\t\t  \n\t\t\t\t\t  if (doc.book.editor[j].name) {\n\t\t\t\t\t\ttriples.push(triple(editor_id,\n\t\t\t\t\t\t  'http://schema.org/name', // ?\n\t\t\t\t\t\t  doc.book.editor[j].name));\n\t\t\t\t\t  }\n\t\t\t\t\t}\n              \n              \n              }\n \n              if (doc.book.pages) {\n\t\t\t\t\tvar parts = doc.book.pages.match(/^(.*)\\--(.*)$/);\n\t\t\t\t\tif (parts) {\n\t\t\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t\t\t'http://schema.org/pageStart',\n\t\t\t\t\t\tparts[1]));\n\t\t\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t\t\t'http://schema.org/pageEnd',\n\t\t\t\t\t\tparts[2]));\n\t\t\t\t\t} else {\n\t\t\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t\t\t'http://schema.org/pagination',\n\t\t\t\t\t\tdoc.book.pages));\n\t\t\t\t\t}              \n\t\t\t  }\n            \n           \n           \n           }\n           break;           \n          \n\t\t  case 'author':\n\t\t\tvar n = doc[i].length;\n\t\t\t\n\t\t\t// store an ordered list of authors as well\n\t\t\t\n\t\t\t//http://purl.org/ontology/bibo/contributorList\n\t\t\t\n\t\t\t\n\t\t\tfor (var j = 0; j < n; j++) {\n\t\t\t  var author_id = '';\n\n\t\t\t  // create identifier\n\t\t\t  author_id = subject_id + '#author_' + (j + 1);\n\n\t\t\t  // type, need to handle organisations as authors\n\t\t\t  triples.push(triple(author_id,\n\t\t\t\t'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n\t\t\t\t'http://schema.org/Person'));\n\n\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t'http://schema.org/author',\n\t\t\t\tauthor_id));\n\n\t\t\t  // name\n\t\t\t  if (doc[i][j].firstname) {\n\t\t\t\ttriples.push(triple(author_id,\n\t\t\t\t  'http://schema.org/givenName', // ?\n\t\t\t\t  doc[i][j].firstname));\n\t\t\t  }\n\n\t\t\t  if (doc[i][j].lastname) {\n\t\t\t\ttriples.push(triple(author_id,\n\t\t\t\t  'http://schema.org/familyName', // ?\n\t\t\t\t  doc[i][j].lastname));\n\t\t\t  }\n\t\t\t  \n\t\t\t  if (doc[i][j].name) {\n\t\t\t\ttriples.push(triple(author_id,\n\t\t\t\t  'http://schema.org/name', // ?\n\t\t\t\t  doc[i][j].name));\n\t\t\t  }\n\t\t\t}\n\t\t\tbreak;\n\t\t\t\n        case 'publisher':\n        \tif (isObject(doc[i])) {\n        \t\tif (doc[i].name) {\n        \t\t\ttriples.push(triple(subject_id,\n    \t        \t  'http://schema.org/publisher',\n        \t     \t doc[i].name));\n        \t\t}\n        \t} else {\n\t            triples.push(triple(subject_id,\n    \t          'http://schema.org/publisher',\n        \t      doc[i]));\n        \t}\n          break;\n\n        case 'abstract':\n            triples.push(triple(subject_id,\n              'http://schema.org/description',\n              doc[i]));\n          break;\n\t\t\t\n\t\t\t\n        case 'year':\n            triples.push(triple(subject_id,\n              'http://schema.org/datePublished',\n              doc[i].toString()));\n          break;\n\n        default:\n          break;\n      }\n    }\n    \n\n    if (type == '') {\n      type = 'http://schema.org/CreativeWork';\n    }\n    \n\n    // defaults\n    triples.push(triple(subject_id,\n      'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n      type));\n\n    output(doc, triples);\n  \n}\n\nfunction (doc) {\n  var types = ['article','book','chapter','generic'];\n  var type = types.indexOf(doc.type);\n\n  if (type != -1) {\n  \tmessage(doc);\n  }\n \n}\n\n// END COUCHDB VIEW"}}}
